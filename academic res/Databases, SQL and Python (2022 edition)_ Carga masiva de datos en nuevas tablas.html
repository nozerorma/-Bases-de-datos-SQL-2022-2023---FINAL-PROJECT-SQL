<!DOCTYPE html>
<!-- saved from url=(0055)https://bbddmasterisciii.github.io/05-Python/index.html -->
<html lang="en" class=" jyuyasr idc0_345"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2023-01-14 10:51:53 +0000">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="https://bbddmasterisciii.github.io">
    <link rel="stylesheet" type="text/css" href="./Databases, SQL and Python (2022 edition)_ Carga masiva de datos en nuevas tablas_files/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="./Databases, SQL and Python (2022 edition)_ Carga masiva de datos en nuevas tablas_files/bootstrap-theme.css">
    <link rel="stylesheet" type="text/css" href="./Databases, SQL and Python (2022 edition)_ Carga masiva de datos en nuevas tablas_files/lesson.css">
    <link rel="stylesheet" type="text/css" href="./Databases, SQL and Python (2022 edition)_ Carga masiva de datos en nuevas tablas_files/syntax.css">
    <link rel="stylesheet" type="text/css" href="./Databases, SQL and Python (2022 edition)_ Carga masiva de datos en nuevas tablas_files/asciinema-player.css">

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://bbddmasterisciii.github.io/assets/favicons/swc/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://bbddmasterisciii.github.io/assets/favicons/swc/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://bbddmasterisciii.github.io/assets/favicons/swc/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://bbddmasterisciii.github.io/assets/favicons/swc/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://bbddmasterisciii.github.io/assets/favicons/swc/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://bbddmasterisciii.github.io/assets/favicons/swc/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://bbddmasterisciii.github.io/assets/favicons/swc/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://bbddmasterisciii.github.io/assets/favicons/swc/apple-touch-icon-152x152.png">
    <link rel="icon" type="image/png" href="https://bbddmasterisciii.github.io/assets/favicons/swc/favicon-196x196.png" sizes="196x196">
    <link rel="icon" type="image/png" href="https://bbddmasterisciii.github.io/assets/favicons/swc/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="https://bbddmasterisciii.github.io/assets/favicons/swc/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://bbddmasterisciii.github.io/assets/favicons/swc/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="https://bbddmasterisciii.github.io/assets/favicons/swc/favicon-128.png" sizes="128x128">
    <meta name="application-name" content="Software Carpentry - Databases, SQL and Python (2022 edition)">
    <meta name="msapplication-TileColor" content="#FFFFFF">
    <meta name="msapplication-TileImage" content="https://bbddmasterisciii.github.io/assets/favicons/swc/mstile-144x144.png">
    <meta name="msapplication-square70x70logo" content="https://bbddmasterisciii.github.io/assets/favicons/swc/mstile-70x70.png">
    <meta name="msapplication-square150x150logo" content="https://bbddmasterisciii.github.io/assets/favicons/swc/mstile-150x150.png">
    <meta name="msapplication-wide310x150logo" content="https://bbddmasterisciii.github.io/assets/favicons/swc/mstile-310x150.png">
    <meta name="msapplication-square310x310logo" content="https://bbddmasterisciii.github.io/assets/favicons/swc/mstile-310x310.png">

    
    <script async="" src="./Databases, SQL and Python (2022 edition)_ Carga masiva de datos en nuevas tablas_files/analytics.js"></script><script src="./Databases, SQL and Python (2022 edition)_ Carga masiva de datos en nuevas tablas_files/asciinema-player.min.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <title>Databases, SQL and Python (2022 edition): Carga masiva de datos en nuevas tablas</title>
  </head>
  <body>
    <div class="container">
      
<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="https://software-carpentry.org/" class="pull-left">
        <img class="navbar-logo" src="./Databases, SQL and Python (2022 edition)_ Carga masiva de datos en nuevas tablas_files/swc-icon-blue.svg" alt="Software Carpentry logo">
      </a>
      

      
      <a class="navbar-brand" href="https://bbddmasterisciii.github.io/">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="https://bbddmasterisciii.github.io/CODE_OF_CONDUCT.html">Conducta</a></li>

        
	
        <li><a href="https://bbddmasterisciii.github.io/setup.html">Configuración</a></li>

        
        <li class="dropdown">
          <a href="https://bbddmasterisciii.github.io/" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Lecciones <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="https://bbddmasterisciii.github.io/01-sqlite3/index.html">Familiarización con la shell SQLite</a></li>
            
            <li><a href="https://bbddmasterisciii.github.io/01.1-sqlite3/index.html">Nuestra primera base de datos</a></li>
            
            <li><a href="https://bbddmasterisciii.github.io/02-transacciones/index.html">Manipulación de datos</a></li>
            
            <li><a href="https://bbddmasterisciii.github.io/02.1-transacciones/index.html">Transacciones</a></li>
            
            <li><a href="https://bbddmasterisciii.github.io/03-DBI/index.html">Acceso mediante programa a la base de datos.</a></li>
            
            <li><a href="https://bbddmasterisciii.github.io/04-Clinvar/index.html">Creación de nuevas tablas</a></li>
            
            <li><a href="https://bbddmasterisciii.github.io/05-Python/index.html">Carga masiva de datos en nuevas tablas</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="https://bbddmasterisciii.github.io/aio.html">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="https://bbddmasterisciii.github.io/" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="https://bbddmasterisciii.github.io/reference.html">Referencias</a></li>
            
            <li><a href="https://bbddmasterisciii.github.io/about/index.html">About</a></li>
            
            <li><a href="https://bbddmasterisciii.github.io/discuss/index.html">Discussion</a></li>
            
            <li><a href="https://bbddmasterisciii.github.io/figures/index.html">Figures</a></li>
            
            <li><a href="https://bbddmasterisciii.github.io/guide/index.html">Instructor Notes</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="https://bbddmasterisciii.github.io/LICENSE.html">Licencia</a></li>
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>


<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="https://bbddmasterisciii.github.io/04-Clinvar/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="https://bbddmasterisciii.github.io/">Databases, SQL and Python (2022 edition)</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="https://bbddmasterisciii.github.io/"><span class="glyphicon glyphicon-menu-up" aria-hidden="true"></span><span class="sr-only">lesson home</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Carga masiva de datos en nuevas tablas</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>


<blockquote class="objectives">
  <h2>Sumario</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teoría:</strong> 15 min
      <br>
      <strong>Ejercicios:</strong> 60 min
    </div>
    <div class="col-md-9">
      <strong>Preguntas</strong>
      <ul>
	
	<li><p>Cómo podemos insertar miles de tuplas de forma automática</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objetivos</strong>
      <ul>
	
	<li><p>Conocer el fundamento de la programación relacionada con SQL desde Python</p>
</li>
	
	<li><p>Leer ficheros de nuestro ordenador e insertar la información relevante en una base de datos relacional</p>
</li>
	
	<li><p>Almacenar datos desde Python en una base de datos</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<blockquote class="callout">
  <h2 id="1-creación-de-un-script-de-python-para-insertar-datos-de-clinvar">1. Creación de un script de python para insertar datos de ClinVar</h2>
  <p>Dentro del código Python, lo primero que se hará es ejecutar todas estas sentencias SQL, existan o no las tablas. Por ello se ha usado la variante <code class="language-plaintext highlighter-rouge">IF NOT EXISTS</code>:</p>

  <div class="language-python python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_file</span><span class="p">)</span>

<span class="n">cur</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
	<span class="c1"># Let's enable the foreign keys integrity checks
</span>	<span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"PRAGMA FOREIGN_KEYS=ON"</span><span class="p">)</span>
	
	<span class="c1"># And create the tables, in case they were not previously
</span>	<span class="c1"># created in a previous use
</span>	<span class="k">for</span> <span class="n">tableDecl</span> <span class="ow">in</span> <span class="n">CLINVAR_TABLE_DEFS</span><span class="p">:</span>
		<span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">tableDecl</span><span class="p">)</span>
<span class="k">except</span> <span class="n">sqlite3</span><span class="p">.</span><span class="n">Error</span><span class="p">:</span>
	<span class="k">print</span><span class="p">(</span><span class="s">"An error occurred: {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
	<span class="n">cur</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>  </div>

  <p>Para leer el fichero tabular comprimido es abrirlo con la librería <a href="https://docs.python.org/3/library/gzip.html" target="_blank">gzip</a>:</p>

  <div class="language-python python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">gzip</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">clinvar_file</span><span class="p">,</span><span class="s">"rt"</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">)</span> <span class="k">as</span> <span class="n">cf</span><span class="p">:</span>
	<span class="n">headerMapping</span> <span class="o">=</span> <span class="bp">None</span>
</code></pre></div>  </div>

  <p>Lo primero que se hará es averiguar el nombre de las columnas, y sus posiciones, preservando esa información para su uso a posteriori:</p>

  <div class="language-python python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">cf</span><span class="p">:</span>
	<span class="c1"># First, let's remove the newline
</span>	<span class="n">wline</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
	
	<span class="c1"># Now, detecting the header
</span>	<span class="k">if</span> <span class="p">(</span><span class="n">headerMapping</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">wline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">'#'</span><span class="p">):</span>
		<span class="n">wline</span> <span class="o">=</span> <span class="n">wline</span><span class="p">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">"#"</span><span class="p">)</span>
		<span class="n">columnNames</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s">"\t"</span><span class="p">,</span><span class="n">wline</span><span class="p">)</span>
		
		<span class="n">headerMapping</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="c1"># And we are saving the correspondence of column name and id
</span>		<span class="k">for</span> <span class="n">columnId</span><span class="p">,</span> <span class="n">columnName</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">columnNames</span><span class="p">):</span>
			<span class="n">headerMapping</span><span class="p">[</span><span class="n">columnName</span><span class="p">]</span> <span class="o">=</span> <span class="n">columnId</span>
</code></pre></div>  </div>

  <p>Dentro del código Python la inserción de datos es relativamente simple, requiriendo ajustes en los valores recuperados para traducir <code class="language-plaintext highlighter-rouge">-</code> a <code class="language-plaintext highlighter-rouge">None</code>.
Como otras tablas de datos correlacionados necesitarán el valor asignado a <code class="language-plaintext highlighter-rouge">ventry_id</code> mediante el autoincremental, después de la inserción
el cursor nos proporcionará dicho dato mediante <code class="language-plaintext highlighter-rouge">cur.lastrowid</code>:</p>

  <div class="language-python python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">else</span><span class="p">:</span>
		<span class="c1"># We are reading the file contents	
</span>		<span class="n">columnValues</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s">"\t"</span><span class="p">,</span><span class="n">wline</span><span class="p">)</span>
		
		<span class="c1"># As these values can contain "nulls", which are
</span>		<span class="c1"># designed as '-', substitute them for None
</span>		<span class="k">for</span> <span class="n">iCol</span><span class="p">,</span> <span class="n">vCol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">columnValues</span><span class="p">):</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vCol</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">vCol</span> <span class="o">==</span> <span class="s">"-"</span><span class="p">:</span>
				<span class="n">columnValues</span><span class="p">[</span><span class="n">iCol</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
		
		<span class="c1"># And extracting what we really need
</span>		<span class="c1"># Table variation
</span>		<span class="n">allele_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">columnValues</span><span class="p">[</span><span class="n">headerMapping</span><span class="p">[</span><span class="s">"AlleleID"</span><span class="p">]])</span>
		<span class="n">name</span> <span class="o">=</span> <span class="n">columnValues</span><span class="p">[</span><span class="n">headerMapping</span><span class="p">[</span><span class="s">"Name"</span><span class="p">]]</span>
		<span class="n">allele_type</span> <span class="o">=</span> <span class="n">columnValues</span><span class="p">[</span><span class="n">headerMapping</span><span class="p">[</span><span class="s">"Type"</span><span class="p">]]</span>
		<span class="n">dbSNP_id</span> <span class="o">=</span> <span class="n">columnValues</span><span class="p">[</span><span class="n">headerMapping</span><span class="p">[</span><span class="s">"RS# (dbSNP)"</span><span class="p">]]</span>
		<span class="n">phenotype_list</span> <span class="o">=</span> <span class="n">columnValues</span><span class="p">[</span><span class="n">headerMapping</span><span class="p">[</span><span class="s">"PhenotypeList"</span><span class="p">]]</span>
		<span class="n">assembly</span> <span class="o">=</span> <span class="n">columnValues</span><span class="p">[</span><span class="n">headerMapping</span><span class="p">[</span><span class="s">"Assembly"</span><span class="p">]]</span>
		<span class="n">chro</span> <span class="o">=</span> <span class="n">columnValues</span><span class="p">[</span><span class="n">headerMapping</span><span class="p">[</span><span class="s">"Chromosome"</span><span class="p">]]</span>
		<span class="n">chro_start</span> <span class="o">=</span> <span class="n">columnValues</span><span class="p">[</span><span class="n">headerMapping</span><span class="p">[</span><span class="s">"Start"</span><span class="p">]]</span>
		<span class="n">chro_stop</span> <span class="o">=</span> <span class="n">columnValues</span><span class="p">[</span><span class="n">headerMapping</span><span class="p">[</span><span class="s">"Stop"</span><span class="p">]]</span>
		<span class="n">ref_allele</span> <span class="o">=</span> <span class="n">columnValues</span><span class="p">[</span><span class="n">headerMapping</span><span class="p">[</span><span class="s">"ReferenceAllele"</span><span class="p">]]</span>
		<span class="n">alt_allele</span> <span class="o">=</span> <span class="n">columnValues</span><span class="p">[</span><span class="n">headerMapping</span><span class="p">[</span><span class="s">"AlternateAllele"</span><span class="p">]]</span>
		<span class="n">cytogenetic</span> <span class="o">=</span> <span class="n">columnValues</span><span class="p">[</span><span class="n">headerMapping</span><span class="p">[</span><span class="s">"Cytogenetic"</span><span class="p">]]</span>
		<span class="n">variation_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">columnValues</span><span class="p">[</span><span class="n">headerMapping</span><span class="p">[</span><span class="s">"VariationID"</span><span class="p">]])</span>
		
		<span class="n">gene_id</span> <span class="o">=</span> <span class="n">columnValues</span><span class="p">[</span><span class="n">headerMapping</span><span class="p">[</span><span class="s">"GeneID"</span><span class="p">]]</span>
		<span class="n">gene_symbol</span> <span class="o">=</span> <span class="n">columnValues</span><span class="p">[</span><span class="n">headerMapping</span><span class="p">[</span><span class="s">"GeneSymbol"</span><span class="p">]]</span>
		<span class="n">HGNC_ID</span> <span class="o">=</span> <span class="n">columnValues</span><span class="p">[</span><span class="n">headerMapping</span><span class="p">[</span><span class="s">"HGNC_ID"</span><span class="p">]]</span>
		
		<span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"""
			INSERT INTO variant(
				allele_id,
				name,
				type,
				dbsnp_id,
				phenotype_list,
				gene_id,
				gene_symbol,
				hgnc_id,
				assembly,
				chro,
				chro_start,
				chro_stop,
				ref_allele,
				alt_allele,
				cytogenetic,
				variation_id)
			VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)
		"""</span><span class="p">,</span> <span class="p">(</span><span class="n">allele_id</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">allele_type</span><span class="p">,</span><span class="n">dbSNP_id</span><span class="p">,</span><span class="n">phenotype_list</span><span class="p">,</span><span class="n">gene_id</span><span class="p">,</span><span class="n">gene_symbol</span><span class="p">,</span><span class="n">HGNC_ID</span><span class="p">,</span><span class="n">assembly</span><span class="p">,</span><span class="n">chro</span><span class="p">,</span><span class="n">chro_start</span><span class="p">,</span><span class="n">chro_stop</span><span class="p">,</span><span class="n">ref_allele</span><span class="p">,</span><span class="n">alt_allele</span><span class="p">,</span><span class="n">cytogenetic</span><span class="p">,</span><span class="n">variation_id</span><span class="p">))</span>
		
		<span class="c1"># The autoincremented value is got here
</span>		<span class="n">ventry_id</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">lastrowid</span>
		
		<span class="c1"># Clinical significance
</span>		<span class="n">significance</span> <span class="o">=</span> <span class="n">columnValues</span><span class="p">[</span><span class="n">headerMapping</span><span class="p">[</span><span class="s">"ClinicalSignificance"</span><span class="p">]]</span>
		<span class="k">if</span> <span class="n">significance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">prep_sig</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">ventry_id</span><span class="p">,</span> <span class="n">sig</span><span class="p">)</span>  <span class="k">for</span> <span class="n">sig</span> <span class="ow">in</span> <span class="n">re</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s">"/"</span><span class="p">,</span><span class="n">significance</span><span class="p">)</span> <span class="p">]</span>
			<span class="n">cur</span><span class="p">.</span><span class="n">executemany</span><span class="p">(</span><span class="s">"""
				INSERT INTO clinical_sig(
					ventry_id,
					significance)
				VALUES(?,?)
			"""</span><span class="p">,</span> <span class="n">prep_sig</span><span class="p">)</span>
		
		<span class="c1"># Review status
</span>		<span class="n">status_str</span> <span class="o">=</span> <span class="n">columnValues</span><span class="p">[</span><span class="n">headerMapping</span><span class="p">[</span><span class="s">"ReviewStatus"</span><span class="p">]]</span>
		<span class="k">if</span> <span class="n">status_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">prep_status</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">ventry_id</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>  <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">re</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s">", "</span><span class="p">,</span><span class="n">status_str</span><span class="p">)</span> <span class="p">]</span>
			<span class="n">cur</span><span class="p">.</span><span class="n">executemany</span><span class="p">(</span><span class="s">"""
				INSERT INTO review_status(
					ventry_id,
					status)
				VALUES(?,?)
			"""</span><span class="p">,</span> <span class="n">prep_status</span><span class="p">)</span>
		
		<span class="c1"># Variant Phenotypes
</span>		<span class="n">variant_pheno_str</span> <span class="o">=</span> <span class="n">columnValues</span><span class="p">[</span><span class="n">headerMapping</span><span class="p">[</span><span class="s">"PhenotypeIDS"</span><span class="p">]]</span>
		<span class="k">if</span> <span class="n">variant_pheno_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">variant_pheno_list</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s">";"</span><span class="p">,</span><span class="n">variant_pheno_str</span><span class="p">)</span>
			<span class="n">prep_pheno</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">phen_group_id</span><span class="p">,</span> <span class="n">variant_pheno</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variant_pheno_list</span><span class="p">):</span>
				<span class="n">variant_annots</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s">","</span><span class="p">,</span><span class="n">variant_pheno</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">variant_annot</span> <span class="ow">in</span> <span class="n">variant_annots</span><span class="p">:</span>
					<span class="n">phen</span> <span class="o">=</span> <span class="n">variant_annot</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">":"</span><span class="p">)</span>
					<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">phen</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
						<span class="n">phen_ns</span> <span class="p">,</span> <span class="n">phen_id</span> <span class="o">=</span> <span class="n">phen</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
						<span class="n">prep_pheno</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">ventry_id</span><span class="p">,</span><span class="n">phen_group_id</span><span class="p">,</span><span class="n">phen_ns</span><span class="p">,</span><span class="n">phen_id</span><span class="p">))</span>
					<span class="k">elif</span> <span class="n">variant_annot</span> <span class="o">!=</span> <span class="s">"na"</span><span class="p">:</span>
						<span class="k">print</span><span class="p">(</span><span class="s">"DEBUG: {}</span><span class="se">\n\t</span><span class="s">{}</span><span class="se">\n\t</span><span class="s">{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">variant_annot</span><span class="p">,</span><span class="n">variant_pheno_str</span><span class="p">,</span><span class="n">line</span><span class="p">),</span><span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
			
			<span class="n">cur</span><span class="p">.</span><span class="n">executemany</span><span class="p">(</span><span class="s">"""
				INSERT INTO variant_phenotypes(
					ventry_id,
					phen_group_id,
					phen_ns,
					phen_id)
				VALUES(?,?,?,?)
			"""</span><span class="p">,</span> <span class="n">prep_pheno</span><span class="p">)</span>
</code></pre></div>  </div>

  <p>El programa se ejecutaría de la siguiente manera, dando como resultado un fichero de base de datos SQLite con todo el contenido extraído de ClinVar, listo para ser consultado programáticamente o mediante <em>shell</em> de SQLite:</p>

  <div class="language-bash bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 clinvar_parser.py clinvar.db variant_summary.txt.gz
sqlite3 clinvar.db <span class="s1">'SELECT COUNT(*) FROM variant'</span>
</code></pre></div>  </div>

</blockquote>
<div style="text-align: center">


Download cast <a href="https://bbddmasterisciii.github.io/files/casts/clinvar_20230113.cast" target="_blank">/files/casts/clinvar_20230113.cast</a>
	<div style="height: 90vh; margin:auto" id="ap_0">
		<script>
		    AsciinemaPlayer.create(
			"../files/casts/clinvar_20230113.cast",
			document.getElementById("ap_0"),
			{
			    fit: 'both',
			    idleTimeLimit: 2,
			}
		    );
		</script><div class="asciinema-player-wrapper" tabindex="-1"><div class="asciinema-player asciinema-theme-asciinema" style="height: 761px; width: 1128.25px;"><pre class="asciinema-terminal cursor blink" style="width: 80ch; height: 32em; font-size: 189.303%; line-height: 1.33333em;"></pre><div class="control-bar seekable"><span class="playback-button"><svg version="1.1" viewBox="0 0 12 12" class="icon"><path d="M1,0 L11,6 L1,12 Z"></path></svg></span><span class="timer"><span class="time-elapsed">--:--</span><span class="time-remaining">--:--</span></span><span class="fullscreen-button" title="Toggle fullscreen mode"><svg version="1.1" viewBox="0 0 12 12" class="icon"><path d="M12,0 L7,0 L9,2 L7,4 L8,5 L10,3 L12,5 Z"></path><path d="M0,12 L0,7 L2,9 L4,7 L5,8 L3,10 L5,12 Z"></path></svg><svg version="1.1" viewBox="0 0 12 12" class="icon"><path d="M7,5 L7,0 L9,2 L11,0 L12,1 L10,3 L12,5 Z"></path><path d="M5,7 L0,7 L2,9 L0,11 L1,12 L3,10 L5,12 Z"></path></svg></span><span class="progressbar"><span class="bar"><span class="gutter"><span style="width: 100%; transform: scaleX(0); transform-origin: left center;"></span></span></span></span></div><div class="start-prompt"><div class="play-button"><div><span><svg version="1.1" viewBox="0 0 866.0254037844387 866.0254037844387" class="icon"><defs><mask id="small-triangle-mask"><rect width="100%" height="100%" fill="white"></rect><polygon points="508.01270189221935 433.01270189221935, 208.0127018922194 259.8076211353316, 208.01270189221927 606.217782649107" fill="black"></polygon></mask></defs><polygon points="808.0127018922194 433.01270189221935, 58.01270189221947 -1.1368683772161603e-13, 58.01270189221913 866.0254037844386" mask="url(#small-triangle-mask)" fill="white" class="play-btn-fill"></polygon><polyline points="481.2177826491071 333.0127018922194, 134.80762113533166 533.0127018922194" stroke="white" stroke-width="90" class="play-btn-stroke"></polyline></svg></span></div></div></div></div></div>
	</div>
</div>



<blockquote class="keypoints">
  <h2>No olvidar</h2>
  <ul>
    
    <li><p>Casi cualquier gestor de base de datos tiene un interfaz de carga para ser usado desde cualquier lenguaje de programación</p>
</li>
    
    <li><p>Para SQLite se usa en Python el paquete <code class="language-plaintext highlighter-rouge">sqlite3</code></p>
</li>
    
  </ul>
</blockquote>

</article>

<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="https://bbddmasterisciii.github.io/04-Clinvar/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="https://bbddmasterisciii.github.io/"><span class="glyphicon glyphicon-menu-up" aria-hidden="true"></span><span class="sr-only">lesson home</span></a>
      
    </h3>
  </div>
</div>


      
      
<footer>
  <div class="row">
    <div class="col-md-6 copyright" align="left">
	
	Copyright © 2019–2023
	<a href="https://orcid.org/0000-0002-0621-9914" target="_blank">Eduardo Andrés</a> &amp; <a href="https://orcid.org/0000-0002-4806-5140" target="_blank">José Mª Fernández</a>
        <br>
	Copyright © 2018–2019
	<a href="https://carpentries.org/">The Carpentries</a>
        <br>
        Copyright © 2016–2018
	<a href="https://software-carpentry.org/">Software Carpentry Foundation</a>
	
    </div>
    <div class="col-md-6 help-links" align="right">
	
	<a href="https://github.com/bbddmasterisciii/bbddmasterisciii.github.io/edit/gh-pages/_episodes/05-Python.md">Edit on GitHub</a>
	
	/
	<a href="https://github.com/bbddmasterisciii/bbddmasterisciii.github.io/blob/gh-pages/CONTRIBUTING.md">Contributing</a>
	/
	<a href="https://github.com/bbddmasterisciii/bbddmasterisciii.github.io/">Source</a>
	/
	<a href="https://github.com/bbddmasterisciii/bbddmasterisciii.github.io/blob/gh-pages/CITATION">Cite</a>
	/
	<a href="mailto:eduardo.andres@csic.es,jose.m.fernandez@bsc.es?subject=Question%20about%20%27Databases,%20SQL%20and%20Python%27">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.2">9.5.2</a>.
    </div>
  </div>
</footer>

      
    </div>
    
<script src="./Databases, SQL and Python (2022 edition)_ Carga masiva de datos en nuevas tablas_files/jquery.min.js"></script>
<script src="./Databases, SQL and Python (2022 edition)_ Carga masiva de datos en nuevas tablas_files/bootstrap.min.js"></script>
<script src="./Databases, SQL and Python (2022 edition)_ Carga masiva de datos en nuevas tablas_files/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  

</body></html>